<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arico - Th∆∞∆°ng M·∫°i ƒêi·ªán T·ª≠</title>
    
    <!-- Bootstrap 5.3.3 CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    
    <style>
        /* Custom CSS */
        .product-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            height: 100%;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .product-image {
            height: 200px;
            object-fit: cover;
            width: 100%;
        }
        
        .price {
            color: #e74c3c;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .original-price {
            text-decoration: line-through;
            color: #95a5a6;
            font-size: 0.9em;
        }
        
        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            padding: 4px 8px;
            font-size: 12px;
        }
        
        .loading {
            display: none;
        }
        
        .loading.show {
            display: block;
        }
        
        .login-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .hero-section {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 80px 0;
        }
        
        .category-filter {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .order-summary {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }
        
        .payment-info {
            background: #e8f5e8;
            border: 2px solid #28a745;
            border-radius: 10px;
            padding: 20px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="#"><i class="bi bi-shop"></i> ShopOnline</a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#products">S·∫£n ph·∫©m</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#about">V·ªÅ ch√∫ng t√¥i</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#contact">Li√™n h·ªá</a>
                    </li>
                </ul>
                
                <div class="d-flex align-items-center">
                    <!-- Login Status -->
                    <div id="loginStatus" class="me-3">
                        <button id="loginBtn" class="btn btn-outline-light btn-sm">
                            <i class="bi bi-google"></i> ƒêƒÉng nh·∫≠p
                        </button>
                        <span id="userInfo" class="d-none text-light"></span>
                        <button id="logoutBtn" class="btn btn-outline-light btn-sm ms-2 d-none">ƒêƒÉng xu·∫•t</button>
                    </div>
                    
                    <!-- Cart Button -->
                    <button class="btn btn-outline-light position-relative me-2" data-bs-toggle="modal" data-bs-target="#cartModal">
                        <i class="bi bi-cart3"></i>
                        <span id="cartCount" class="cart-badge">0</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section text-center">
        <div class="container">
            <h1 class="display-4 fw-bold mb-4">Ch√†o m·ª´ng ƒë·∫øn v·ªõi ShopOnline</h1>
            <p class="lead mb-4">Kh√°m ph√° h√†ng ng√†n s·∫£n ph·∫©m ch·∫•t l∆∞·ª£ng v·ªõi gi√° t·ªët nh·∫•t</p>
            <a href="#products" class="btn btn-warning btn-lg">Mua s·∫Øm ngay</a>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container my-5">
        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="loading text-center">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">ƒêang t·∫£i...</span>
            </div>
            <p class="mt-2">ƒêang t·∫£i d·ªØ li·ªáu s·∫£n ph·∫©m...</p>
        </div>

        <!-- Filter Section -->
        <div id="filterSection" class="category-filter">
            <div class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">T√¨m ki·∫øm:</label>
                    <input type="text" id="searchInput" class="form-control" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m...">
                </div>
                <div class="col-md-2">
                    <label class="form-label">Danh m·ª•c:</label>
                    <select id="categoryFilter" class="form-select">
                        <option value="">T·∫•t c·∫£</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">Gi√° t·ª´:</label>
                    <input type="number" id="minPrice" class="form-control" placeholder="0">
                </div>
                <div class="col-md-2">
                    <label class="form-label">Gi√° ƒë·∫øn:</label>
                    <input type="number" id="maxPrice" class="form-control" placeholder="999999">
                </div>
                <div class="col-md-2">
                    <label class="form-label">S·∫Øp x·∫øp:</label>
                    <select id="sortBy" class="form-select">
                        <option value="">M·∫∑c ƒë·ªãnh</option>
                        <option value="price-asc">Gi√° tƒÉng d·∫ßn</option>
                        <option value="price-desc">Gi√° gi·∫£m d·∫ßn</option>
                        <option value="name-asc">T√™n A-Z</option>
                        <option value="name-desc">T√™n Z-A</option>
                    </select>
                </div>
                <div class="col-md-1">
                    <label class="form-label">&nbsp;</label>
                    <button id="clearFilters" class="btn btn-secondary w-100">Reset</button>
                </div>
            </div>
        </div>

        <!-- Products Section -->
        <section id="products">
            <h2 class="text-center mb-4">S·∫£n ph·∫©m n·ªïi b·∫≠t</h2>
            <div id="productsContainer" class="row g-4">
                <!-- Products will be loaded here -->
            </div>
            
            <!-- No products found message -->
            <div id="noProductsMessage" class="text-center mt-5 d-none">
                <i class="bi bi-search display-1 text-muted"></i>
                <h4 class="text-muted">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o</h4>
                <p class="text-muted">Vui l√≤ng th·ª≠ l·∫°i v·ªõi t·ª´ kh√≥a kh√°c</p>
            </div>
        </section>
    </div>

    <!-- Cart Modal -->
    <div class="modal fade" id="cartModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-cart3"></i> Gi·ªè h√†ng c·ªßa b·∫°n</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="cartItems">
                        <p class="text-center text-muted">Gi·ªè h√†ng tr·ªëng</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="w-100">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5>T·ªïng c·ªông: <span id="cartTotal" class="price">0ƒë</span></h5>
                        </div>
                        <div class="d-grid gap-2">
                            <button id="checkoutBtn" class="btn btn-success btn-lg" disabled>
                                <i class="bi bi-credit-card"></i> Thanh to√°n
                            </button>
                            <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Ti·∫øp t·ª•c mua s·∫Øm</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div class="modal fade" id="checkoutModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-credit-card"></i> Thanh to√°n ƒë∆°n h√†ng</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="checkoutForm">
                        <div class="row">
                            <div class="col-md-8">
                                <h6>Th√¥ng tin giao h√†ng</h6>
                                <div class="mb-3">
                                    <label class="form-label">H·ªç t√™n *</label>
                                    <input type="text" id="customerName" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">S·ªë ƒëi·ªán tho·∫°i *</label>
                                    <input type="tel" id="customerPhone" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" id="customerEmail" class="form-control">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">ƒê·ªãa ch·ªâ giao h√†ng *</label>
                                    <textarea id="customerAddress" class="form-control" rows="3" required></textarea>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Ghi ch√∫</label>
                                    <textarea id="orderNote" class="form-control" rows="2" placeholder="Ghi ch√∫ ƒë·∫∑c bi·ªát cho ƒë∆°n h√†ng..."></textarea>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="order-summary">
                                    <h6>T√≥m t·∫Øt ƒë∆°n h√†ng</h6>
                                    <div id="orderSummary"></div>
                                    <hr>
                                    <div class="d-flex justify-content-between">
                                        <strong>T·ªïng c·ªông:</strong>
                                        <strong class="price" id="orderTotal">0ƒë</strong>
                                    </div>
                                </div>
                                
                                <div class="payment-info mt-3">
                                    <h6><i class="bi bi-bank"></i> Th√¥ng tin chuy·ªÉn kho·∫£n</h6>
                                    <p class="mb-1"><strong>Ng√¢n h√†ng:</strong> Vietcombank</p>
                                    <p class="mb-1"><strong>STK:</strong> 1234567890</p>
                                    <p class="mb-1"><strong>Ch·ªß TK:</strong> NGUYEN VAN A</p>
                                    <p class="mb-1"><strong>N·ªôi dung CK:</strong> <span id="transferContent">MA_DON_HANG</span></p>
                                    <small class="text-muted">Vui l√≤ng chuy·ªÉn kho·∫£n theo ƒë√∫ng n·ªôi dung ƒë·ªÉ x·ª≠ l√Ω nhanh ƒë∆°n h√†ng</small>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="button" id="confirmOrderBtn" class="btn btn-success">
                        <i class="bi bi-check-circle"></i> X√°c nh·∫≠n ƒë√£ thanh to√°n
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content text-center">
                <div class="modal-body p-4">
                    <i class="bi bi-check-circle-fill text-success display-1 mb-3"></i>
                    <h4>ƒê·∫∑t h√†ng th√†nh c√¥ng!</h4>
                    <p>M√£ ƒë∆°n h√†ng c·ªßa b·∫°n: <strong id="orderCode"></strong></p>
                    <p class="text-muted">Ch√∫ng t√¥i s·∫Ω li√™n h·ªá x√°c nh·∫≠n trong th·ªùi gian s·ªõm nh·∫•t.</p>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">ƒê√≥ng</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light py-4 mt-5">
        <div class="container text-center">
            <p>ARICO &copy; 2025 üáªüá≥. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
            <p>Li√™n h·ªá: info@aricovn.com | 0931-516-579</p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>
    
    <!-- Google Sign-In -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/google-auth-library/8.9.0/google-auth-library.min.js"></script>

    <script>
        // ================================
        // CONFIGURATION - C·∫§U H√åNH H·ªÜ TH·ªêNG
        // ================================
        
        const CONFIG = {
            // URL c·ªßa Google Apps Script Web App (thay th·∫ø b·∫±ng URL th·ª±c t·∫ø c·ªßa b·∫°n)
            SCRIPT_URL: 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec',
            
            // Google OAuth Client ID (thay th·∫ø b·∫±ng Client ID th·ª±c t·∫ø)
            GOOGLE_CLIENT_ID: 'YOUR_GOOGLE_CLIENT_ID.googleusercontent.com',
            
            // Th·ªùi gian polling ƒë·ªÉ c·∫≠p nh·∫≠t d·ªØ li·ªáu (milliseconds)
            POLLING_INTERVAL: 30000, // 30 gi√¢y
            
            // Th√¥ng tin ng√¢n h√†ng
            BANK_INFO: {
                name: 'VietinBank',
                account: '0931516579',
                owner: 'NGUYEN NGOC MINH'
            }
        };

        // ================================
        // GLOBAL VARIABLES - BI·∫æN TO√ÄN C·ª§C
        // ================================
        
        let products = []; // Danh s√°ch s·∫£n ph·∫©m t·ª´ Google Sheet
        let filteredProducts = []; // Danh s√°ch s·∫£n ph·∫©m sau khi l·ªçc
        let cart = []; // Gi·ªè h√†ng
        let currentUser = null; // Th√¥ng tin user ƒë√£ ƒëƒÉng nh·∫≠p
        let categories = []; // Danh s√°ch danh m·ª•c
        
        // ================================
        // AUTHENTICATION - X√ÅC TH·ª∞C GOOGLE
        // ================================
        
        /**
         * Kh·ªüi t·∫°o Google Sign-In
         */
        function initGoogleAuth() {
            // T·∫°m th·ªùi s·ª≠ d·ª•ng mock authentication ƒë·ªÉ demo
            // Trong th·ª±c t·∫ø, b·∫°n c·∫ßn c·∫•u h√¨nh Google OAuth properly
            console.log('Google Auth initialized');
            
            // Mock login cho demo
            document.getElementById('loginBtn').addEventListener('click', () => {
                // Gi·∫£ l·∫≠p ƒëƒÉng nh·∫≠p th√†nh c√¥ng
                currentUser = {
                    name: 'Demo User',
                    email: 'demo@example.com',
                    picture: 'https://via.placeholder.com/40'
                };
                updateLoginUI();
            });
            
            document.getElementById('logoutBtn').addEventListener('click', () => {
                currentUser = null;
                updateLoginUI();
            });
        }
        
        /**
         * C·∫≠p nh·∫≠t giao di·ªán ƒëƒÉng nh·∫≠p
         */
        function updateLoginUI() {
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const userInfo = document.getElementById('userInfo');
            
            if (currentUser) {
                loginBtn.classList.add('d-none');
                logoutBtn.classList.remove('d-none');
                userInfo.classList.remove('d-none');
                userInfo.innerHTML = `<i class="bi bi-person-circle"></i> ${currentUser.name}`;
                
                // Auto-fill user info in checkout form
                document.getElementById('customerEmail').value = currentUser.email;
            } else {
                loginBtn.classList.remove('d-none');
                logoutBtn.classList.add('d-none');
                userInfo.classList.add('d-none');
                document.getElementById('customerEmail').value = '';
            }
        }

        // ================================
        // DATA MANAGEMENT - QU·∫¢N L√ù D·ªÆ LI·ªÜU
        // ================================
        
        /**
         * T·∫£i d·ªØ li·ªáu s·∫£n ph·∫©m t·ª´ Google Sheet
         */
        async function loadProducts() {
            try {
                showLoading(true);
                
                // T·∫°m th·ªùi s·ª≠ d·ª•ng d·ªØ li·ªáu m·∫´u cho demo
                // Trong th·ª±c t·∫ø, call API ƒë·∫øn Google Apps Script
                await new Promise(resolve => setTimeout(resolve, 1000)); // Simulate API call
                
                products = [
                    {
                        id: 1,
                        name: 'iPhone 15 Pro Max',
                        category: 'ƒêi·ªán tho·∫°i',
                        price: 34990000,
                        originalPrice: 37990000,
                        image: 'https://via.placeholder.com/300x200?text=iPhone+15+Pro+Max',
                        description: 'iPhone 15 Pro Max m·ªõi nh·∫•t v·ªõi chip A17 Pro',
                        stock: 50
                    },
                    {
                        id: 2,
                        name: 'Samsung Galaxy S24 Ultra',
                        category: 'ƒêi·ªán tho·∫°i',
                        price: 32990000,
                        originalPrice: 35990000,
                        image: 'https://via.placeholder.com/300x200?text=Galaxy+S24+Ultra',
                        description: 'Samsung Galaxy S24 Ultra v·ªõi S Pen t√≠ch h·ª£p',
                        stock: 30
                    },
                    {
                        id: 3,
                        name: 'MacBook Air M3',
                        category: 'Laptop',
                        price: 28990000,
                        originalPrice: 31990000,
                        image: 'https://via.placeholder.com/300x200?text=MacBook+Air+M3',
                        description: 'MacBook Air v·ªõi chip M3 m·∫°nh m·∫Ω',
                        stock: 25
                    },
                    {
                        id: 4,
                        name: 'Dell XPS 13',
                        category: 'Laptop',
                        price: 25990000,
                        originalPrice: 27990000,
                        image: 'https://via.placeholder.com/300x200?text=Dell+XPS+13',
                        description: 'Dell XPS 13 si√™u m·ªèng nh·∫π',
                        stock: 20
                    },
                    {
                        id: 5,
                        name: 'AirPods Pro 2',
                        category: 'Ph·ª• ki·ªán',
                        price: 5990000,
                        originalPrice: 6990000,
                        image: 'https://via.placeholder.com/300x200?text=AirPods+Pro+2',
                        description: 'AirPods Pro th·∫ø h·ªá 2 v·ªõi ANC',
                        stock: 100
                    },
                    {
                        id: 6,
                        name: 'Apple Watch Series 9',
                        category: 'ƒê·ªìng h·ªì th√¥ng minh',
                        price: 8990000,
                        originalPrice: 9990000,
                        image: 'https://via.placeholder.com/300x200?text=Apple+Watch+9',
                        description: 'Apple Watch Series 9 v·ªõi chip S9',
                        stock: 40
                    }
                ];
                
                // Extract categories
                categories = [...new Set(products.map(p => p.category))];
                populateCategoryFilter();
                
                filteredProducts = [...products];
                displayProducts();
                
            } catch (error) {
                console.error('Error loading products:', error);
                showError('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu s·∫£n ph·∫©m. Vui l√≤ng th·ª≠ l·∫°i sau.');
            } finally {
                showLoading(false);
            }
        }
        
        /**
         * G·ª≠i ƒë∆°n h√†ng l√™n Google Sheet
         */
        async function submitOrder(orderData) {
            try {
                // Trong th·ª±c t·∫ø, g·ª≠i POST request ƒë·∫øn Google Apps Script
                const response = await fetch(CONFIG.SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'submitOrder',
                        data: orderData
                    })
                });
                
                // T·∫°m th·ªùi return mock response cho demo
                return {
                    success: true,
                    orderCode: generateOrderCode()
                };
                
            } catch (error) {
                console.error('Error submitting order:', error);
                throw error;
            }
        }

        // ================================
        // UI FUNCTIONS - FUNCTIONS GIAO DI·ªÜN
        // ================================
        
        /**
         * Hi·ªÉn th·ªã/·∫©n loading indicator
         */
        function showLoading(show) {
            const loadingIndicator = document.getElementById('loadingIndicator');
            const filterSection = document.getElementById('filterSection');
            const productsContainer = document.getElementById('productsContainer');
            
            if (show) {
                loadingIndicator.classList.add('show');
                filterSection.style.display = 'none';
                productsContainer.style.display = 'none';
            } else {
                loadingIndicator.classList.remove('show');
                filterSection.style.display = 'block';
                productsContainer.style.display = 'flex';
            }
        }
        
        /**
         * Hi·ªÉn th·ªã th√¥ng b√°o l·ªói
         */
        function showError(message) {
            alert(message); // Trong th·ª±c t·∫ø c√≥ th·ªÉ d√πng toast ho·∫∑c modal ƒë·∫πp h∆°n
        }
        
        /**
         * Populate category filter dropdown
         */
        function populateCategoryFilter() {
            const categoryFilter = document.getElementById('categoryFilter');
            categoryFilter.innerHTML = '<option value="">T·∫•t c·∫£</option>';
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryFilter.appendChild(option);
            });
        }
        
        /**
         * Hi·ªÉn th·ªã danh s√°ch s·∫£n ph·∫©m
         */
        function displayProducts() {
            const container = document.getElementById('productsContainer');
            const noProductsMessage = document.getElementById('noProductsMessage');
            
            if (filteredProducts.length === 0) {
                container.innerHTML = '';
                noProductsMessage.classList.remove('d-none');
                return;
            }
            
            noProductsMessage.classList.add('d-none');
            
            container.innerHTML = filteredProducts.map(product => `
                <div class="col-lg-4 col-md-6 col-sm-12">
                    <div class="card product-card h-100">
                        <img src="${product.image}" class="card-img-top product-image" alt="${product.name}">
                        <div class="card-body d-flex flex-column">
                            <h6 class="card-title">${product.name}</h6>
                            <p class="card-text text-muted small flex-grow-1">${product.description}</p>
                            <div class="mb-2">
                                <span class="badge bg-secondary">${product.category}</span>
                                <span class="badge bg-info ms-1">C√≤n ${product.stock}</span>
                            </div>
                            <div class="price-section mb-3">
                                <span class="price">${formatPrice(product.price)}</span>
                                ${product.originalPrice > product.price ? 
                                    `<span class="original-price ms-2">${formatPrice(product.originalPrice)}</span>` : ''}
                            </div>
                            <button class="btn btn-primary w-100" onclick="addToCart(${product.id})" 
                                    ${product.stock === 0 ? 'disabled' : ''}>
                                <i class="bi bi-cart-plus"></i> 
                                ${product.stock === 0 ? 'H·∫øt h√†ng' : 'Th√™m v√†o gi·ªè'}
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ================================
        // CART MANAGEMENT - QU·∫¢N L√ù GI·ªé H√ÄNG
        // ================================
        
        /**
         * Th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng
         */
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product || product.stock === 0) return;
            
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                if (existingItem.quantity < product.stock) {
                    existingItem.quantity++;
                } else {
                    showError('S·ªë l∆∞·ª£ng v∆∞·ª£t qu√° t·ªìn kho!');
                    return;
                }
            } else {
                cart.push({
                    ...product,
                    quantity: 1
                });
            }
            
            updateCartUI();
            saveCartToStorage();
            
            // Show feedback
            showAddToCartFeedback(product.name);
        }
        
        /**
         * X√≥a s·∫£n ph·∫©m kh·ªèi gi·ªè h√†ng
         */
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCartUI();
            saveCartToStorage();
        }
        
        /**
         * C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng s·∫£n ph·∫©m trong gi·ªè
         */
        function updateCartQuantity(productId, newQuantity) {
            const item = cart.find(item => item.id === productId);
            const product = products.find(p => p.id === productId);
            
            if (!item || !product) return;
            
            if (newQuantity <= 0) {
                removeFromCart(productId);
                return;
            }
            
            if (newQuantity > product.stock) {
                showError('S·ªë l∆∞·ª£ng v∆∞·ª£t qu√° t·ªìn kho!');
                return;
            }
            
            item.quantity = newQuantity;
            updateCartUI();
            saveCartToStorage();
        }
        
        /**
         * C·∫≠p nh·∫≠t giao di·ªán gi·ªè h√†ng
         */
        function updateCartUI() {
            const cartCount = document.getElementById('cartCount');
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            const checkoutBtn = document.getElementById('checkoutBtn');
            
            // Update cart count
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalItems;
            
            // Update cart items display
            if (cart.length === 0) {
                cartItems.innerHTML = '<p class="text-center text-muted">Gi·ªè h√†ng tr·ªëng</p>';
                checkoutBtn.disabled = true;
            } else {
                cartItems.innerHTML = cart.map(item => `
                    <div class="d-flex align-items-center mb-3 p-3 border rounded">
                        <img src="${item.image}" alt="${item.name}" class="me-3" style="width: 60px; height: 60px; object-fit: cover;">
                        <div class="flex-grow-1">
                            <h6 class="mb-1">${item.name}</h6>
                            <div class="text-muted small">${formatPrice(item.price)}</div>
                        </div>
                        <div class="d-flex align-items-center">
                            <button class="btn btn-sm btn-outline-secondary" onclick="updateCartQuantity(${item.id}, ${item.quantity - 1})">-</button>
                            <span class="mx-2">${item.quantity}</span>
                            <button class="btn btn-sm btn-outline-secondary" onclick="updateCartQuantity(${item.id}, ${item.quantity + 1})">+</button>
                            <button class="btn btn-sm btn-outline-danger ms-2" onclick="removeFromCart(${item.id})">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
                checkoutBtn.disabled = false;
            }
            
            // Update total
            const total = calculateCartTotal();
            cartTotal.textContent = formatPrice(total);
        }
        
        /**
         * T√≠nh t·ªïng ti·ªÅn gi·ªè h√†ng
         */
        function calculateCartTotal() {
            return cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        }
        
        /**
         * L∆∞u gi·ªè h√†ng v√†o localStorage
         */
        function saveCartToStorage() {
            // localStorage.setItem('cart', JSON.stringify(cart));
            // Note: localStorage kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£ trong artifacts, ch·ªâ l∆∞u trong memory
            console.log('Cart saved to memory:', cart);
        }
        
        /**
         * T·∫£i gi·ªè h√†ng t·ª´ localStorage
         */
        function loadCartFromStorage() {
            // const savedCart = localStorage.getItem('cart');
            // if (savedCart) {
            //     cart = JSON.parse(savedCart);
            //     updateCartUI();
            // }
            // Note: localStorage kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£ trong artifacts
            console.log('Cart loaded from memory');
        }
        
        /**
         * Hi·ªÉn th·ªã feedback khi th√™m v√†o gi·ªè h√†ng
         */
        function showAddToCartFeedback(productName) {
            // T·∫°o toast notification ƒë∆°n gi·∫£n
            const toast = document.createElement('div');
            toast.className = 'position-fixed top-0 end-0 p-3';
            toast.style.zIndex = '9999';
            toast.innerHTML = `
                <div class="toast show" role="alert">
                    <div class="toast-header">
                        <i class="bi bi-check-circle text-success me-2"></i>
                        <strong class="me-auto">Th√†nh c√¥ng</strong>
                        <button type="button" class="btn-close" onclick="this.closest('.position-fixed').remove()"></button>
                    </div>
                    <div class="toast-body">
                        ƒê√£ th√™m "${productName}" v√†o gi·ªè h√†ng
                    </div>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 3000);
        }

        // ================================
        // FILTER & SEARCH - L·ªåC V√Ä T√åM KI·∫æM
        // ================================
        
        /**
         * √Åp d·ª•ng c√°c b·ªô l·ªçc
         */
        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const minPrice = parseFloat(document.getElementById('minPrice').value) || 0;
            const maxPrice = parseFloat(document.getElementById('maxPrice').value) || Infinity;
            const sortBy = document.getElementById('sortBy').value;
            
            // Filter products
            filteredProducts = products.filter(product => {
                const matchesSearch = product.name.toLowerCase().includes(searchTerm) || 
                                    product.description.toLowerCase().includes(searchTerm);
                const matchesCategory = !categoryFilter || product.category === categoryFilter;
                const matchesPrice = product.price >= minPrice && product.price <= maxPrice;
                
                return matchesSearch && matchesCategory && matchesPrice;
            });
            
            // Sort products
            if (sortBy) {
                filteredProducts.sort((a, b) => {
                    switch (sortBy) {
                        case 'price-asc':
                            return a.price - b.price;
                        case 'price-desc':
                            return b.price - a.price;
                        case 'name-asc':
                            return a.name.localeCompare(b.name);
                        case 'name-desc':
                            return b.name.localeCompare(a.name);
                        default:
                            return 0;
                    }
                });
            }
            
            displayProducts();
        }
        
        /**
         * Reset t·∫•t c·∫£ b·ªô l·ªçc
         */
        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('minPrice').value = '';
            document.getElementById('maxPrice').value = '';
            document.getElementById('sortBy').value = '';
            
            filteredProducts = [...products];
            displayProducts();
        }

        // ================================
        // CHECKOUT PROCESS - QUY TR√åNH THANH TO√ÅN
        // ================================
        
        /**
         * B·∫Øt ƒë·∫ßu qu√° tr√¨nh checkout
         */
        function startCheckout() {
            if (!currentUser) {
                alert('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ƒë·∫∑t h√†ng!');
                return;
            }
            
            if (cart.length === 0) {
                alert('Gi·ªè h√†ng tr·ªëng!');
                return;
            }
            
            // Generate order code
            const orderCode = generateOrderCode();
            document.getElementById('transferContent').textContent = orderCode;
            
            // Fill order summary
            const orderSummary = document.getElementById('orderSummary');
            orderSummary.innerHTML = cart.map(item => `
                <div class="d-flex justify-content-between mb-2">
                    <span>${item.name} x${item.quantity}</span>
                    <span>${formatPrice(item.price * item.quantity)}</span>
                </div>
            `).join('');
            
            document.getElementById('orderTotal').textContent = formatPrice(calculateCartTotal());
            
            // Show checkout modal
            const checkoutModal = new bootstrap.Modal(document.getElementById('checkoutModal'));
            checkoutModal.show();
        }
        
        /**
         * X√°c nh·∫≠n ƒë∆°n h√†ng
         */
        async function confirmOrder() {
            const form = document.getElementById('checkoutForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const orderData = {
                orderCode: document.getElementById('transferContent').textContent,
                customer: {
                    name: document.getElementById('customerName').value,
                    phone: document.getElementById('customerPhone').value,
                    email: document.getElementById('customerEmail').value,
                    address: document.getElementById('customerAddress').value
                },
                items: cart.map(item => ({
                    productId: item.id,
                    name: item.name,
                    price: item.price,
                    quantity: item.quantity,
                    total: item.price * item.quantity
                })),
                total: calculateCartTotal(),
                note: document.getElementById('orderNote').value,
                timestamp: new Date().toISOString(),
                status: 'pending_payment'
            };
            
            try {
                const result = await submitOrder(orderData);
                
                if (result.success) {
                    // Show success modal
                    document.getElementById('orderCode').textContent = result.orderCode;
                    const successModal = new bootstrap.Modal(document.getElementById('successModal'));
                    successModal.show();
                    
                    // Close checkout modal
                    const checkoutModal = bootstrap.Modal.getInstance(document.getElementById('checkoutModal'));
                    checkoutModal.hide();
                    
                    // Clear cart
                    cart = [];
                    updateCartUI();
                    saveCartToStorage();
                    
                    // Reset form
                    form.reset();
                    
                } else {
                    throw new Error('Order submission failed');
                }
                
            } catch (error) {
                console.error('Error confirming order:', error);
                showError('C√≥ l·ªói x·∫£y ra khi ƒë·∫∑t h√†ng. Vui l√≤ng th·ª≠ l·∫°i!');
            }
        }
        
        /**
         * T·∫°o m√£ ƒë∆°n h√†ng ng·∫´u nhi√™n
         */
        function generateOrderCode() {
            return 'DH' + Date.now().toString().slice(-8) + Math.random().toString(36).substr(2, 4).toUpperCase();
        }

        // ================================
        // UTILITY FUNCTIONS - H√ÄM TI·ªÜN √çCH
        // ================================
        
        /**
         * Format price to Vietnamese currency
         */
        function formatPrice(price) {
            return price.toLocaleString('vi-VN') + 'ƒë';
        }
        
        /**
         * Debounce function for search input
         */
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        /**
         * Auto-update data periodically
         */
        function startDataPolling() {
            setInterval(async () => {
                try {
                    await loadProducts();
                    console.log('Data updated automatically');
                } catch (error) {
                    console.error('Auto update failed:', error);
                }
            }, CONFIG.POLLING_INTERVAL);
        }

        // ================================
        // EVENT LISTENERS - X·ª¨ L√ù S·ª∞ KI·ªÜN
        // ================================
        
        /**
         * Kh·ªüi t·∫°o event listeners
         */
        function initEventListeners() {
            // Search and filter events
            const searchInput = document.getElementById('searchInput');
            const debouncedSearch = debounce(applyFilters, 300);
            searchInput.addEventListener('input', debouncedSearch);
            
            document.getElementById('categoryFilter').addEventListener('change', applyFilters);
            document.getElementById('minPrice').addEventListener('input', debouncedSearch);
            document.getElementById('maxPrice').addEventListener('input', debouncedSearch);
            document.getElementById('sortBy').addEventListener('change', applyFilters);
            document.getElementById('clearFilters').addEventListener('click', clearFilters);
            
            // Cart events
            document.getElementById('checkoutBtn').addEventListener('click', startCheckout);
            document.getElementById('confirmOrderBtn').addEventListener('click', confirmOrder);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'k') {
                    e.preventDefault();
                    searchInput.focus();
                }
            });
        }

        // ================================
        // INITIALIZATION - KH·ªûI T·∫†O ·ª®NG D·ª§NG
        // ================================
        
        /**
         * Kh·ªüi t·∫°o ·ª©ng d·ª•ng
         */
        async function initApp() {
            console.log('Initializing E-commerce App...');
            
            try {
                // Initialize authentication
                initGoogleAuth();
                
                // Load cart from storage
                loadCartFromStorage();
                
                // Load products
                await loadProducts();
                
                // Initialize event listeners
                initEventListeners();
                
                // Start data polling for real-time updates
                startDataPolling();
                
                console.log('App initialized successfully!');
                
            } catch (error) {
                console.error('App initialization failed:', error);
                showError('Kh√¥ng th·ªÉ kh·ªüi t·∫°o ·ª©ng d·ª•ng. Vui l√≤ng t·∫£i l·∫°i trang.');
            }
        }
        
        // Start the application when DOM is ready
        document.addEventListener('DOMContentLoaded', initApp);
        
        // Expose functions to global scope for onclick handlers
        window.addToCart = addToCart;
        window.removeFromCart = removeFromCart;
        window.updateCartQuantity = updateCartQuantity;
        
    </script>
</body>
</html>            
